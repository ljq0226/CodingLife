


# 操作系统

## 第一章 操作系统引论


### 01 定义 
---

#### 资源管理的观点

操作系统是**控制管理**计算机的**软、硬件资源**，合理地**组织**计算机的**工作流程**，以及**方便用户**的**程序集合**，需要完成以下工作：
+ 跟踪和监控程序的运行结果，记录程序的运行状态
+ 进行计算机各种资源的分配
+ 回收资源，以便再分配

---

#### 用户的观点
操作系统是配置在计算机硬件上的第一层软件，是对硬件系统的第一次补充，是紧贴计算机硬件，支撑其他软件工作的软件。

>计算机硬件  -> 操作系统 -> 系统工具 -> 应用软件 -> 用户 

---


### 02 发展


### 03 特征 ✅

+ 并发性：两个或两个以上的事物在**同一时间间隔**内发生
+ 共享性： 系统中的软、硬件资源在其上的供多个程序共同享用 
	+ **互斥共享**--某一时间内只允许一个进程访问，该进程访问完成后，别人才可访问。eg:打印机
	+ **同时访问**--某个时间段内，允许多个进程同时访问。eg:磁盘
+ 虚拟性：通过把某种技术手段把一个**物理上的实体**变成多个**逻辑上的对应物**
+ 不确定性(随机性)：系统中各种事件的**发生顺序**是**不确定**的

---

### 04 功能 ✅

+ 存储管理 -内存储器
+ 进程管理 -cpu
+ 设备管理 -外部设备
+ 文件管理 -软件资源数据
+ 操作系统接口 


#### 进程管理 
234
+ 任务 
	+ 对处理机的**分配和运行**实施有效管理
	+ 在多到程序环境下，处理机的分配和运行以进程为单位，因此对处理机的管理挤兑进程的管理
+ 功能
	+ 进程控制：**创建、撤销**进程以及控制进程在运行方式中的**状态转换**
	+ 进程同步：对进程的执行进行协调，**互斥方式**与**同步方式**
	+ 进程通信：进程之间**传递消息**
	+ 进程调度：在若干进程中，按照一定的**算法**选择一个**进程**，让其**占用处理机**

#### 存储管理
56
+ 任务 
	+ 方便用户使用内存、提高内存的利用率
	+ 从逻辑上扩充内存
+ 功能
	+ 内存分配：为执行的程序机器相关数据分配内存空间
	+ 地址映射：**逻辑地址**(编译后的地址编号)与**物理地址**(内存实际的地址编号)的映射 计算机内存在逻辑与物理地址的映射关系
	+ 内存保护：保证内存中两个程序所分配的空间不冲突
	+ 内存扩充：采用软件的手段，从逻辑上扩充内存(虚拟内存)
	+ 进程调度：在若干进程中，按照一定的**算法**选择一个**进程**，让其**占用处理机**

#### 设备管理 
7
+ 任务 
	+ 提高外部设备的利用、方便用户使用外部设备
	+ 完成用户程序请求的I/O操作 为用户分配I/O设备，尽可能地提高输入/输出的速度
+ 功能
	+ 设备分配：为执行中的程序分配相应的设备
	+ 设备控制： 组织设备相关信息，启动设备，执行具体的操作
	+ 设备无关性: 用户程序不与某特定设备绑定
	

#### 文件管理
8
+ 任务 
	+ 程序、数据等信息以文件的形式 放在外存， 对信息的管理
	
+ 功能
	+ 文件存储空间的管理 ： 为用户的文件自动分配磁盘存储空间
	+ 目录管理：记录文件名、文件属性、文件在磁盘的位置，建立索引，实现文件的共享和快速查询
	+ 读写管理：根据文件属性(读写)，执行对磁盘的具体操作(读写)
	+ 文件的存取控制：安全、高效的实现文件的存取操作

#### 操作系统接口
+ 命令接口
	+ 脱机命令接口
	+ 联机命令接口
	+ 图形用户界面：图形化操作界面
+  程序接口
	+ 系统调用，实现程序级访问操作系统的功能



### 05 分类

操作系统是一个动态的发展

+ 批处理操作系统： 程序、数据集程序处理步骤 被成批地输入到计算机中 在系统的控制下自动的执行
+ 单道批处理操作系统：
	+ 内存中仅放一道作业
	+ 作业的完成舒徐与进驻内存的顺序有关
	+ 具有自动性、顺序性、单道性的特点
+ 多道批处理操作系统：
	+ 内存中放多道作业
	+ 作业的完成顺序与进驻内存的舒徐无言歌的对应关系
	+ 具有多道性、无序性和调度性的特点
	+


#### 实时操作系统
实时操作系统能在规定的时间内完成输入信息的处理并作出反应，实时操作系统比
+ 实时控制系统：火灾报警控制系统
+ 实时信息处理系统： 飞机自动订票、情报检索系统


#### 微机操作系统
+ 配置在微型计算机上的操作系统
	+ CP/M 操作系统
	+ MS-DOS
	+ OS/2
	+ Unix
	+ Linux
	+ Windows

#### 多处理机操作系统

+ 支持多个处理机的操作系统
	+ 增加系统的吞吐量
	+ 节省投资
	+ 提高系统的可靠性
+ 非对称多处理机
+ 对称多处理机

#### 其它操作系统
+ 网络操作系统
+ 分布式操作系统

# 第二章 进程与线程

## 01 进程的引入

### 进程的概念
+ 为了真实反映系统的**独立性、并发性、动态性和相互制约**
	+ 动态性：进程是程序的一次执行过程
	+ 并发性：进程是可以和别的计算机**并发**执行的计算--》提高CPU的利用率
	+ 独立性： 进程是一个能**独立**运行的基本单位，是系统进行**资源分配****和**调度**的一个基本单位
	+ 异步性：多个进程并发执行，每个进程的相对速度不可预测

>进程(Process)定义为:"**并发执行**的程序在**一个**数据集合上的**执行过程**"

+ 单道程序的执行
	+ 顺序性
	+ 封闭性
	+ 可在现性

多道程序的并发的执行
+ 间断性
+ 失去封闭性
+ 失去可再现性(的风险)

![[进程并发.excalidraw]]



## 02进程的状态及组成


## 03 进程控制

#### 操作系统内核
+ cpu的两种工作状态:核心态(系统态，管态)和用户态(目态)
>为了防止操作系统汲取关键数据结构别用户程序有意无意的破坏

+ 具有较高的特权，能执行一切指令,能访问所有寄存及内存的所有区域。操作系统通常运行在核心态。
+ 用户态：具有较低的特权执行状态,仅能执行规定指令,访问指定的寄存器和内存指定区域。用户程序通常运行在运行状态
+ 用户态-->核心态:程序调度(中断、异常)
+ 核心态-->用户态:设置程序状态

#### 内核与原语
+ 内核(设计层次)
	+ 系统将一些与硬件紧密相关的模块放入内核，内核主要功能包含:
		+ 时钟管理:分时轮询的时间片，产生中断信号
		+ 中断处理：系统调用、进程调度、设备操作都采用中断处理
		+ 原语处理：操作系统中一些最基本的操作
+ 原语
	+ 原语由若干条指令构成、用于完成一定功能的过程
	+ 原语是“原子操作”。即一个操作中的所有动作，**要么全做**，要么全不做。原子操作是一个不可分割的操作

#### 进程家族树
+ 系统允许一个进程创建控制另一个进程，前者为父进程,后者为子进程
+ 子进程课基础父进程的资源：文件、缓存区
+ 子进程撤销，将资源归还给父进程
+ 父进程撤销，将所有先前的子进程先撤销
#### 进程控制包含的内容
##### 进程的创建
引起创建的操作事件
+ 用户的登录
+ 新作业进入系统
+ 提供服务
+ 应用请求
创建原语所需要的工作
1. 申请空白的PCB
2. 初始化PCB（进程的描述信息、处理机状态信息、进程控制信息）
3. 为进程分配资源、分配存储空间
4. 将新进程插入就绪队列
##### 进程的撤销
引起进程撤销的事件：
+ 进程正常结束
+ 进程异常结束(由于错误或者故障而被迫中止进程)
+ 外界干预
	+ 操作系统干预
	+ 父进程要求撤销
	+ 父进程被撤销
撤销原语所需要的工作:
+ 查找病撤销进程的PCB
+ 若进程处于执行状态,予以终止并进行进程调度
+ 若有子孙,予以终止
+ 归还资源
+ 从所在队列移除

##### 进程的阻塞与唤醒
+ 事件
	+ 请求系统服务
	+ 启动某种操作
	+ 数据尚未到达
	+ 无新工作可做
+ 阻塞原语需要做的工作
	+ 停止进程的执行
	+ 将进程插入到阻塞队列，改变进程中的PCB的状态(阻塞)
	+ 重新调度
+ 唤醒原语要做的工作
	+ 将进程从阻塞队列取下
	+ 插入到就绪队列的队尾
	+ 改变进程在PCB的状态

进程的挂起与激活

挂起原语要做的工作：
+ 检查被挂起进程的状态
+ 如process处于就绪状态,就将process从就绪state ==> 挂起state
+ if Process be in blocking(阻塞) ,then
+ 
## 04 线程(Thread)

+ 线程的引入
	 + 进程是**拥有资源**的**独立**单位
	 + 进程是**独立调度和分派**的**基本**单位

>由于进程是资源owner,在进程的**创建、撤销和切换**中系统位置付出**较大的事件、空间开销**。英雌，系统所设置的进程数量不宜过多

进程和线程的关系
+ 进程-->程序
+ 线程-->函数

#### 定义
+ 线程是进程中的一个实体，是系统独立调度和分派的基本单位,表示进程中的一个控制点,执行一系列指令
	+ 当操作系统引入线程之后，线程成为了调度和分派的基本单位，而不再是进程
	+ 不是所有的OS都支持线程(UNIX不支持，Windows支持)
#### 线程模型


+ 进程是资源的拥有者
+ 线程基本不拥有资源，只有TCB及堆栈指针

#### 线程控制块(TCB)的组成



#### 线程的控制
+ 线程的创建 
	+ 调用线程库中的系统调用create process
	+ 分配进程控制块、栈等必要数据结构
+ 线程的撤销
	+ 通过调用线程库中的系统调用撤销线程
+ 线程的等待
	+ 线程通过调用线程库中的系统调用等待其它的某个线程
+ 线程的让权

#### 进程和线程的区别
+ 调度
	+ 线程调度快，需要空间小
	+ 进程因拥有资源，调度时因负担过重而缓慢
+ 并发性
	+ 在引入线程的操作系统中，不仅进程之间可以并发执行，一个进程中的多个线程之间也可以并发执行
+ 拥有资源
	+ 进程是资源的拥有者
+ 系统的开销
	+ 进程切换的开销远远大于线程切换的开销， 线程的切换省去了资源的回收

#### 线程的实现
+ 用户级线程
	+ 应用程序通过**线程库**设计多线程程序，线程库是用于管理用户级线程的**软件包**
	+ 线程的创建、撤销和切换，都不利于系统调用来实现。线程与内核无关，内核也不知道到线程的存在
+ 内核级线程
	+ 依赖于内核，线程的创建、撤销和切换都由内核实现。在内核中由线程控制块(TCB).内核根据TCB感知线程的存在，并对线程进行控制
+ 组合的方法
	+ 由内核支持的用户线程。一个进程可以有一个或多个轻量级线程，每个轻量级线程由一个单独的内核级线程来支持




#### 多线程问题
+ 线程取消
	+ 立即取消
	+ 延迟取消

+ 信号处理

+ 线程池



# 第三章 进程的同步与通信

## 01 进程的同步与互斥

## 02 经典进程同步问题

## 03 AND信号量

## 04 管程

## 05 进程通信
